const t={LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown"},e=document.querySelector(".start"),s=document.querySelector(".game-score"),a=document.querySelectorAll("tr"),r={lose:document.querySelector(".message-lose"),win:document.querySelector(".message-win"),start:document.querySelector(".message-start")};class i{static gameStatuses={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};constructor(t=this.generateDefaultState()){this.initialState=t,this.state=t.map(t=>[...t]),this.status=i.gameStatuses.IDLE,this.score=0}generateDefaultState(){return[,,,,].fill(0).map(()=>[,,,,].fill(0))}moveLeft(){if(!this.isStateValid(this.state))return;let t=this.state.map(t=>this.applyMove(t));this.updateGameState(t),this.completeMoveTasks()}moveRight(){let t=this.state.map(t=>[...t].reverse());if(!this.isStateValid(t))return;let e=t.map(t=>this.applyMove(t).reverse());this.isStateDifferent(this.state,e)&&(this.updateGameState(e),this.completeMoveTasks())}moveUp(){let t=this.rotateRight(this.state);if(!this.isStateValid(t))return;let e=t.map(t=>this.applyMove([...t])),s=this.rotateLeft(e);this.updateGameState(s),this.completeMoveTasks()}moveDown(){let t=this.rotateRight(this.state).map(t=>[...t].reverse());if(!this.isStateValid(t))return;let e=t.map(t=>this.applyMove(t).reverse()),s=this.rotateLeft(e);this.updateGameState(s),this.completeMoveTasks()}isStateDifferent(t,e){return JSON.stringify(t)!==JSON.stringify(e)}applyMove(t){let e=[],s=0;for(;s<t.length;){let a=t[s],r=t[s+1];a?a===r?(e.push(2*a),this.score+=2*a,s+=2):(e.push(a),s++):s++}for(;e.length<t.length;)e.push(0);return e}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=i.gameStatuses.PLAYING,this.completeMoveTasks(2)}restart(){this.resetState(),this.status=i.gameStatuses.IDLE,this.score=0}generateNewTile(){let t=this.getEmptyCells();if(0===t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}getEmptyCells(){return this.getState().flatMap((t,e)=>t.map((t,s)=>0===t?[e,s]:null)).filter(Boolean)}rotateLeft(t){let e=t.length,s=t[0].length,a=Array.from({length:s},()=>Array(e).fill(""));for(let r=0;r<e;r++)for(let i=0;i<s;i++){let s=e-1-r;a[i][s]=t[r][i]}return a}rotateRight(t){let e=t.length,s=t[0].length,a=Array.from({length:s},()=>Array(e).fill(""));for(let r=0;r<e;r++)for(let e=0;e<s;e++){let i=r;a[s-1-e][i]=t[r][e]}return a}isStateValid(t){if(this.status!==i.gameStatuses.PLAYING)return!1;for(let e of t){let t=!1,s=!1;for(let a=0;a<e.length-1;a++){if(e[a]===e[a+1]){t=!0;break}0===e[a]&&(s=!0)}if(t||s)return!0}return!1}completeMoveTasks(t=1){for(let e=0;e<t;e++)this.generateNewTile();let e=this.getState();this.isVictory(e)?this.status=i.gameStatuses.WIN:this.isDefeat(e)&&(this.status=i.gameStatuses.LOSE)}isDefeat(t){let e=this.rotateRight(t);return[t,e].every(t=>!this.isStateValid(t))}isVictory(t){return t.flat().includes(2048)}resetState(){this.state=this.initialState.map(t=>[...t])}updateGameState(t){this.state=t}}const l=new i;let o=!0;const n=()=>{let t=l.getState();a.forEach((e,s)=>{Array.from(e.cells).forEach(e=>{let a=e.cellIndex,r=t[s][a];e.textContent="",e.className="field-cell",0!==r&&(e.textContent=r,e.classList.add(`field-cell--${r}`))})})},h=()=>{Object.values(r).forEach(t=>t.classList.add("hidden"));let t=l.getStatus();"win"===t?r.win.classList.remove("hidden"):"lose"===t?r.lose.classList.remove("hidden"):"idle"===t&&r.start.classList.remove("hidden")},u=()=>{s.textContent=l.getScore()};e.addEventListener("click",()=>{"Start"===e.textContent?l.start():"Restart"===e.textContent&&(l.restart(),e.textContent="Start",e.classList.replace("restart","start"),u()),n(),h(),o=!0}),document.addEventListener("keydown",s=>{if("idle"!==l.getStatus()){switch(s.key){case t.LEFT:l.moveLeft();break;case t.RIGHT:l.moveRight();break;case t.UP:l.moveUp();break;case t.DOWN:l.moveDown();break;default:return}o&&(e.textContent="Restart",e.classList.replace("start","restart"),o=!1),h(),n(),u()}});
//# sourceMappingURL=index.ec64fb36.js.map
